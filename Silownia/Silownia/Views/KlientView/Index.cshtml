@model Silownia.Models.Klient

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script>
    // Odpala funkcję na load strony
    document.addEventListener("DOMContentLoaded", function() {
        OdbierzWiad();
    });
    function Wyslij() {
        var text1 = document.getElementById('Wiadomosc').value;
        var e = document.getElementById('Trenerzy');
        var idTrenera = e.options[e.selectedIndex].value;
        $.ajax({
            url: '@Url.Action("Act")',
            method: 'GET',
            data: { username: text1, trenerID: idTrenera},
            success: function (data) {
                document.getElementById("Wiadomosc").style.color = "red";
                var a = document.getElementById("Wiadomosc");
                a.value = "Wysłano poprawnie";
                BlokujWiadomosc();
            }, error: function (erro) {
                alert("Wybierz trenera z listy ");
            }
        });
    }

    function OdbierzWiad()
    {
        var okienko = document.getElementById("WiadomosciOdebrane");
        var infoKoncowe="";
        $.ajax({
            url: '@Url.Action("OdbierzWiad")',
            type: "POST",
            success: function (json) {
                $.each(json, function (i, item) {
                    infoKoncowe += item.osWys +" "+ToJavaScriptDate(item.dataWys)+ "\n: " + item.tresc + "\n------------------------------------------------------------------------------------------------------------------------------------\n";
                });
                okienko.innerHTML = infoKoncowe;
            }
        });
    }

    function ToJavaScriptDate(value) {
        var pattern = /Date\(([^)]+)\)/;
        var results = pattern.exec(value);
        var dt = new Date(parseFloat(results[1]));
        return dt.getDate() +"/"+(dt.getMonth() + 1) + "/" + dt.getFullYear()+" "+ dt.getHours() +":"+dt.getMinutes();
    }


    function BlokujWiadomosc() {
        document.getElementById("Wiadomosc").disabled = true;
        document.getElementById("Send").disabled = true;
        document.getElementById("Trenerzy").disabled = true;
    }

    @*function Odbierz()
    {
        var okienko = document.getElementById("WiadomosciOdebrane");
        var osWys ;

        var array = @Html.Raw(Json.Encode(@ViewBag.Wiad));

        for(var i = 0; i < array.length; i++) {
            osWys = array[i].OsobaWysylajaca;

            okienko.innerHTML = array[i].OsobaWysylajaca.imieNazwisko+": "+array[i].Tresc+"\n----------------------------------------------------------------------------------------------------------------------------------------------------------------------";
       
            okienko.style.fontSize = "small";

        }

    }*@


</script>

<html>
    <head>
    
    </head>

    <body>
        @* Zdjecie *@
        <div class="col-xs-2"style="width:315px;height:380px;">
            <img src="https://upload.wikimedia.org/wikipedia/en/7/70/Shawn_Tok_Profile.jpg" height="300" width="300">
        </div>
        @* Dane klienta *@
        <div class="col-xs-3" style="border:solid; height:380px">
        <div style="text-align:right">DANE PERSONALNE</div> 
           <h4>Imie:</h4><h3 style="color:aquamarine">@Model.Imie</h3>
            <br />
            <h4>Nazwisko:</h4><h3 style="color:aquamarine">@Model.Nazwisko</h3>
            <br />
            <h4>Data urodzenia:</h4><h3 style="color:aquamarine">@Model.DataUrodzenia.ToShortDateString()</h3>
            <br />
        </div>
        @* Adres *@
        <div class="col-xs-4" style="border:solid; height:380px; min-width:340px;">
            <div style="text-align:right">ADRES</div> 
            @if (Model.Adres != null)
            {
            <h4>Kod pocztowy:</h4><h3 style="color:aquamarine">@Model.Adres.KodPocztowy</h3>
            <br />
            <h4>Miasto:</h4><h3 style="color:aquamarine">@Model.Adres.Miasto</h3>
            <br />
            <h4>Adres:</h4><h3 style="color:aquamarine">@Model.Adres.Ulica @Model.Adres.NrBudynku  @Model.Adres.NrLokalu</h3>
            <br />
            }
            else
            {
                <h1 style="color:palevioletred; text-align:center">BRAK DANYCH</h1>
            }
        </div>
        @* Umowa *@
        <div class="col-xs-2" style="border:solid; width:300px; height:190px;">
            <h3>Umowa aktywna</h3>  
            @if(@Model.Umowy.FirstOrDefault() != null)
            {
                <h3 style="color:aquamarine">@Model.Umowy.First().DataZakonczenia.ToShortDateString()</h3>

            }
            else
            {
                <h3 style="color:palevioletred">BRAK</h3>
            }

        </div>
        @* Ostatni trening *@
        <div class="col-xs-2" style="border: solid; width:300px; height:190px">

            <h3>Ostatni trening własny</h3>


        </div>

        <div class="col-xs-2" style=" width:735px; height:320px">
          

        </div>
        <div class="col-xs-2" style=" width:700px; height:320px">
        <h3>Odebrane wiadmości <button type="button" id="OdbierzW" class="btn btn-primary" role="button" onclick="OdbierzWiad()" style="width:120px; ">Odśwież</button></h3>

        @if (ViewBag.Wiad != null)
        {

            @Html.TextArea("WiadomosciOdebrane", htmlAttributes: new { style = "width: 100%; max-width: 100%; height:250px;", @readonly = "readonly" })
            
           
         
        }


        </div>

        <div class="col-xs-2" style="border:solid; width:300px; height:320px">

            <h3>Wiadomość do trenera</h3>
          @Html.DropDownList("Trenerzy", String.Empty)
            @Html.TextArea("Wiadomosc",new { @style="width:270px; height:180px" })
            <button type="button" id="Send" class="btn btn-primary" role="button" onclick="Wyslij()" style="width:270px; " >Wyślij</button>
          @*  *@
 
</div>



    </body>
</html>